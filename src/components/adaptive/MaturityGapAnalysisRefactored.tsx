import React from 'react';
import { Scale, ArrowUpDown, TrendingUp } from 'lucide-react';
import { 
  MaturityGapProps, 
  MaturityGapAnalysis 
} from '../../types/analysis-types';
import AnalysisCard from '../shared/AnalysisCard';
import Tooltip from '../ui/Tooltip';
import { analyzeMaturityGap as calculateMaturityGap } from '../../utils/analysis-maturity';
import { getSeverityColorClass } from '../../utils/analysis-ui';

/**
 * –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑—Ä—ã–≤ –∑—Ä–µ–ª–æ—Å—Ç–∏ –º–µ–∂–¥—É –ª–∏—á–Ω—ã–º –∏ –æ—Ç–Ω–æ—à–µ–Ω—á–µ—Å–∫–∏–º —É—Ä–æ–≤–Ω–µ–º
 * @param personalMaturity - —É—Ä–æ–≤–µ–Ω—å –ª–∏—á–Ω–æ–π –∑—Ä–µ–ª–æ—Å—Ç–∏
 * @param relationshipMaturity - —É—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
 * @param dominantZone - –¥–æ–º–∏–Ω–∞–Ω—Ç–Ω–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–æ–Ω–∞ (–¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π)
 * @param indicators - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
 */
const analyzeMaturityGap = (
  personalMaturity: number,
  relationshipMaturity: number,
  dominantZone?: string,
  indicators: string[] = []
): MaturityGapAnalysis => {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â—É—é —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑—Ä—ã–≤–∞ –∑—Ä–µ–ª–æ—Å—Ç–∏
  const { gap, direction, gapSize: calculatedGapSize } = calculateMaturityGap(personalMaturity, relationshipMaturity);
  
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ dominantZone –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
  // –î–ª—è transcendent –∑–æ–Ω—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  const isTranscendent = dominantZone === 'transcendent';
  
  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ä–∞–∑—Ä—ã–≤–∞
  let gapSize = calculatedGapSize;
  
  // –ï—Å–ª–∏ —É –Ω–∞—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑—Ä—ã–≤–∞ –≤ indicators, —É—á–∏—Ç—ã–≤–∞–µ–º –µ–≥–æ
  const hasExtremeIndicator = indicators?.some((i: string) => i.includes('extreme_gap'));
  if (gap === 0) {
    gapSize = 'none';
  } else if (hasExtremeIndicator || isTranscendent) {
    // –î–ª—è transcendent –∑–æ–Ω—ã –∏–ª–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –æ—Ü–µ–Ω–∫—É
  } else if (gap <= 1) {
    gapSize = 'small';
  } else if (gap <= 2) {
    gapSize = 'moderate';
  } else if (gap <= 3) {
    gapSize = 'large';
  } else {
    gapSize = 'extreme';
  }
  
  // –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑—Ä—ã–≤–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  
  // –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å
  if (gapSize === 'none' || gapSize === 'small') {
    return {
      title: '‚öñÔ∏è –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å',
      description: '–í–∞—à –ª–∏—á–Ω–æ—Å—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏ –∏ –∑—Ä–µ–ª–æ—Å—Ç—å –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–º —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–∏.',
      characteristics: [
        '–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ª–∏—á–Ω—ã—Ö —Ü–µ–ª–µ–π –∏ —Ü–µ–ª–µ–π –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
        '–í–∑–∞–∏–º–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –±–µ–∑ —è–≤–Ω—ã—Ö –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–≤',
        '–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç–∏ –∫–∞–∫ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ, —Ç–∞–∫ –∏ –≤–º–µ—Å—Ç–µ',
        '–°—Ö–æ–¥–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π'
      ],
      severity: 'minimal',
      gapSize: gapSize,
      direction: 'balanced',
      balancingStrategies: [
        '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç',
        '–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±—Å—É–∂–¥–∞–π—Ç–µ —Ü–µ–ª–∏ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞',
        '–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–∞–∏–º–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤ –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏—è—Ö',
        '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–π –æ–ø—ã—Ç, —É–≥–ª—É–±–ª—è—é—â–∏–π —Å–≤—è–∑—å'
      ],
      expectedTimeframe: '–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º'
    };
  }
  
  // –õ–∏—á–Ω–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å –≤—ã—à–µ
  if (direction === 'personal_higher') {
    // –£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∞–∑—Ä—ã–≤
    if (gapSize === 'moderate') {
      return {
        title: 'üîº –õ–∏—á–Ω–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å –æ–ø–µ—Ä–µ–∂–∞–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω—á–µ—Å–∫—É—é',
        description: '–í–∞—à –ª–∏—á–Ω–æ—Å—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–µ–∂–∞–µ—Ç —Ç–æ, –∫–∞–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –∑—Ä–µ–ª–æ—Å—Ç—å –≤ –≤–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö.',
        characteristics: [
          '–ë–æ–ª–µ–µ —Ä–∞–∑–≤–∏—Ç—ã–µ –ª–∏—á–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã, —á–µ–º –æ—Ç–Ω–æ—à–µ–Ω—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏',
          '–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —á—É–≤—Å—Ç–≤–æ –Ω–µ–ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö',
          '–°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–º—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é',
          '–í–æ–∑–º–æ–∂–Ω–∞—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—Ä—É—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –æ—Ç–Ω–æ—à–µ–Ω–∏–π'
        ],
        severity: 'moderate',
        gapSize: gapSize,
        direction: direction,
        balancingStrategies: [
          '–†–∞–∑–≤–∏–≤–∞–π—Ç–µ —Ç–µ—Ä–ø–µ–Ω–∏–µ –∫ –ø—Ä–æ—Ü–µ—Å—Å–∞–º —Ä–æ—Å—Ç–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
          '–ò–∑–±–µ–≥–∞–π—Ç–µ –ø–æ–∑–∏—Ü–∏–∏ "—É—á–∏—Ç–µ–ª—è" –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö',
          '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è',
          '–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —É—è–∑–≤–∏–º–æ—Å—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –¥–ª—è —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–≤—è–∑–∏'
        ],
        expectedTimeframe: '3-6 –º–µ—Å—è—Ü–µ–≤ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç–µ –Ω–∞–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏'
      };
    }
    
    // –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑—Ä—ã–≤
    if (gapSize === 'large') {
      return {
        title: 'üîº –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–µ—Ä–µ–∂–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π –∑—Ä–µ–ª–æ—Å—Ç–∏',
        description: '–í–∞—à–∞ –ª–∏—á–Ω–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç —Ç–æ, –∫–∞–∫ –≤—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç–µ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö, —Å–æ–∑–¥–∞–≤–∞—è –∑–∞–º–µ—Ç–Ω—ã–π –¥–∏—Å–±–∞–ª–∞–Ω—Å.',
        characteristics: [
          '–ß–∞—Å—Ç–æ–µ –æ—â—É—â–µ–Ω–∏–µ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞ –¥–∞–∂–µ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö',
          '–°–¥–µ—Ä–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
          '–¢—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –≥–ª—É–±–æ–∫–æ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –æ–ø—ã—Ç–∞ —Å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º',
          '–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –±—Ä–∞—Ç—å –Ω–∞ —Å–µ–±—è —Ä–æ–ª—å –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞ –∏–ª–∏ —Å–ø–∞—Å–∞—Ç–µ–ª—è'
        ],
        severity: 'significant',
        gapSize: gapSize,
        direction: direction,
        balancingStrategies: [
          '–ü–†–ò–û–†–ò–¢–ï–¢: –ß–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ü–µ–ª–µ–π —Ä–∞–∑–≤–∏—Ç–∏—è',
          '–ü–æ–∏—Å–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ä–æ—Å—Ç–∞ –≤–Ω–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
          '–û—Ç–∫—Ä—ã—Ç—ã–π –¥–∏–∞–ª–æ–≥ –æ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö —Ä–∞–∑–≤–∏—Ç–∏—è –±–µ–∑ –æ—Å—É–∂–¥–µ–Ω–∏—è',
          '–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–æ—Å—Ç–∞'
        ],
        expectedTimeframe: '6-12 –º–µ—Å—è—Ü–µ–≤ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –≤—Å—Ç—Ä–µ—á–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø–∞—Ä—Ç–Ω–µ—Ä–∞'
      };
    }
    
    // –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π —Ä–∞–∑—Ä—ã–≤
    if (gapSize === 'extreme') {
      return {
        title: '‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑—Ä—ã–≤ –∑—Ä–µ–ª–æ—Å—Ç–∏',
        description: '–ú–µ–∂–¥—É –≤–∞—à–µ–π –ª–∏—á–Ω–æ–π –∑—Ä–µ–ª–æ—Å—Ç—å—é –∏ –∑—Ä–µ–ª–æ—Å—Ç—å—é –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≥–ª—É–±–æ–∫–∏–π —Ä–∞–∑—Ä—ã–≤, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è.',
        characteristics: [
          '–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è—Ö',
          '–•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ —á—É–≤—Å—Ç–≤–æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –Ω–µ–ø–æ–Ω–∏–º–∞–Ω–∏—è',
          '–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å "—Å–ø—É—Å–∫–∞—Ç—å—Å—è" –¥–æ —É—Ä–æ–≤–Ω—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
          '–ü—Ä–∏–∑–Ω–∞–∫–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–ª–∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—â–µ–Ω–∏—è'
        ],
        severity: 'critical',
        gapSize: gapSize,
        direction: direction,
        balancingStrategies: [
          '–ü–†–ò–û–†–ò–¢–ï–¢: –ì–ª—É–±–æ–∫–∞—è –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
          '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Å–∏—Ç—É–∞—Ü–∏–∏',
          '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ç–∫–∏—Ö –≥—Ä–∞–Ω–∏—Ü –¥–ª—è —Å–∞–º–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è',
          '–ß–µ—Å—Ç–Ω–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –≤–µ–¥–µ—Ç –∫ —Ç—Ä—É–¥–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º'
        ],
        expectedTimeframe: '–¢—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è; –∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω—ã –±–µ–∑ —Å–µ—Ä—å–µ–∑–Ω–æ–π –≤–Ω–µ—à–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏'
      };
    }
  }
  
  // –û—Ç–Ω–æ—à–µ–Ω—á–µ—Å–∫–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å –≤—ã—à–µ
  if (direction === 'relationship_higher') {
    // –£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∞–∑—Ä—ã–≤
    if (gapSize === 'moderate') {
      return {
        title: 'üîΩ –û—Ç–Ω–æ—à–µ–Ω—á–µ—Å–∫–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å –æ–ø–µ—Ä–µ–∂–∞–µ—Ç –ª–∏—á–Ω—É—é',
        description: '–ö–∞—á–µ—Å—Ç–≤–æ –≤–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–µ–º–Ω–æ–≥–æ –æ–ø–µ—Ä–µ–∂–∞–µ—Ç –≤–∞—à –ª–∏—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Ä–æ—Å—Ç–∞.',
        characteristics: [
          '–û—Ç–Ω–æ—à–µ–Ω–∏—è –≤—ã—Å—Ç—É–ø–∞—é—Ç —Å—Ç–∏–º—É–ª–æ–º –¥–ª—è –ª–∏—á–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è',
          '–ü–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç –≤—ã—Å—Ç—É–ø–∞—Ç—å –∫–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º –≤–∞—à–µ–≥–æ —Ä–æ—Å—Ç–∞',
          '–ò–Ω–æ–≥–¥–∞ —á—É–≤—Å—Ç–≤–æ, —á—Ç–æ –≤—ã –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º',
          '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –æ—Ç–Ω–æ—à–µ–Ω–∏—è'
        ],
        severity: 'moderate',
        gapSize: gapSize,
        direction: direction,
        balancingStrategies: [
          '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —Ä–æ—Å—Ç–∞',
          '–†–∞–∑–≤–∏–≤–∞–π—Ç–µ –ª–∏—á–Ω—É—é –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç',
          '–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –ø—Ä–∏–Ω—è—Ç–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–µ–∑ —á—É–≤—Å—Ç–≤–∞ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏',
          '–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –ª–∏—á–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –¥–ª—è —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏'
        ],
        expectedTimeframe: '3-6 –º–µ—Å—è—Ü–µ–≤ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç–µ –Ω–∞–¥ –ª–∏—á–Ω—ã–º —Ä–∞–∑–≤–∏—Ç–∏–µ–º'
      };
    }
    
    // –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑—Ä—ã–≤
    if (gapSize === 'large') {
      return {
        title: 'üîΩ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–µ—Ä–µ–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω—á–µ—Å–∫–æ–π –∑—Ä–µ–ª–æ—Å—Ç–∏',
        description: '–ö–∞—á–µ—Å—Ç–≤–æ –≤–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç –≤–∞—à –ª–∏—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è, —á—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.',
        characteristics: [
          '–ß—É–≤—Å—Ç–≤–æ, —á—Ç–æ –≤—ã –Ω–µ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç–µ —ç—Ç–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
          '–°—Ç—Ä–∞—Ö –ø–æ—Ç–µ—Ä–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏–∑-–∑–∞ –ª–∏—á–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤',
          '–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–∏–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏',
          '–í–æ–∑–º–æ–∂–Ω–æ–µ –∏–∑–±–µ–≥–∞–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —á–µ—Ä–µ–∑ —Ñ–æ–∫—É—Å –Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö'
        ],
        severity: 'significant',
        gapSize: gapSize,
        direction: direction,
        balancingStrategies: [
          '–ü–†–ò–û–†–ò–¢–ï–¢: –†–∞–±–æ—Ç–∞ –Ω–∞–¥ –ª–∏—á–Ω—ã–º —Ä–∞–∑–≤–∏—Ç–∏–µ–º –∏ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–æ–π',
          '–¢–µ—Ä–∞–ø–∏—è –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∫–æ—Ä–Ω–µ–π –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏',
          '–ü—Ä–∞–∫—Ç–∏–∫–∏ —Å–∞–º–æ—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–µ–±—è',
          '–û—Ç–∫—Ä—ã—Ç—ã–π –¥–∏–∞–ª–æ–≥ —Å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä–∞—Ö–∞—Ö'
        ],
        expectedTimeframe: '6-12 –º–µ—Å—è—Ü–µ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –ª–∏—á–Ω–æ—Å—Ç–Ω—ã–º —Ä–æ—Å—Ç–æ–º'
      };
    }
    
    // –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π —Ä–∞–∑—Ä—ã–≤
    if (gapSize === 'extreme') {
      return {
        title: '‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑—Ä—ã–≤ –∑—Ä–µ–ª–æ—Å—Ç–∏',
        description: '–°—É—â–µ—Å—Ç–≤—É–µ—Ç –≥–ª—É–±–æ–∫–∏–π —Ä–∞–∑—Ä—ã–≤ –º–µ–∂–¥—É –≤–∞—à–µ–π –ª–∏—á–Ω–æ–π –∑—Ä–µ–ª–æ—Å—Ç—å—é –∏ –∫–∞—á–µ—Å—Ç–≤–æ–º –æ—Ç–Ω–æ—à–µ–Ω–∏–π, —á—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.',
        characteristics: [
          '–•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ —á—É–≤—Å—Ç–≤–æ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Å–∞–º–æ–∑–≤–∞–Ω—Å—Ç–≤–∞',
          '–ö–æ–º–ø—É–ª—å—Å–∏–≤–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ "–∑–∞—Å–ª—É–∂–∏—Ç—å" –æ—Ç–Ω–æ—à–µ–Ω–∏—è',
          '–°–∞–±–æ—Ç–∞–∂ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏–∑-–∑–∞ –≥–ª—É–±–æ–∫–æ–π –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏',
          '–°–æ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è'
        ],
        severity: 'critical',
        gapSize: gapSize,
        direction: direction,
        balancingStrategies: [
          '–ü–†–ò–û–†–ò–¢–ï–¢: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞',
          '–ì–ª—É–±–æ–∫–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–æ—Ä–Ω–µ–≤—ã–º–∏ —É–±–µ–∂–¥–µ–Ω–∏—è–º–∏ –æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏',
          '–†–∞–∑–≤–∏—Ç–∏–µ –∑–¥–æ—Ä–æ–≤—ã—Ö –≥—Ä–∞–Ω–∏—Ü –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö',
          '–ü—Ä–∞–∫—Ç–∏–∫–∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä—ã–≤–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫–∏'
        ],
        expectedTimeframe: '–¢—Ä–µ–±—É–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã (1-2 –≥–æ–¥–∞) —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π'
      };
    }
  }
  
  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑—Ä—ã–≤ —Å –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º –≤–ª–∏—è–Ω–∏–µ–º
  return {
    title: 'üìä –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑—Ä—ã–≤ –∑—Ä–µ–ª–æ—Å—Ç–∏',
    description: '–ú–µ–∂–¥—É –≤–∞—à–µ–π –ª–∏—á–Ω–æ–π –∑—Ä–µ–ª–æ—Å—Ç—å—é –∏ –∑—Ä–µ–ª–æ—Å—Ç—å—é –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑—Ä—ã–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è.',
    characteristics: [
      '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–∞—Ä–∏–∞—Ü–∏—è –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Å—Ñ–µ—Ä',
      '–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Ä–æ—Å—Ç–µ',
      '–û–±—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–≤–∏—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–º',
      '–í–∑–∞–∏–º–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –Ω–µ–±–æ–ª—å—à–∏–µ —Ä–∞–∑–ª–∏—á–∏—è'
    ],
    severity: 'minimal',
    gapSize: 'small',
    direction: direction,
    balancingStrategies: [
      '–û–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ–±–ª–∞—Å—Ç–∏ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞',
      '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—É—é –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –æ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö',
      '–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–∞–∏–º–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏',
      '–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±—Å—É–∂–¥–∞–π—Ç–µ –æ–±—â–∏–µ —Ü–µ–ª–∏ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è'
    ],
    expectedTimeframe: '–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –º–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —É—Å–∏–ª–∏—è–º–∏'
  };
};

/**
 * –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–∑—Ä—ã–≤–∞ –∑—Ä–µ–ª–æ—Å—Ç–∏
 * @param personalMaturity - —É—Ä–æ–≤–µ–Ω—å –ª–∏—á–Ω–æ–π –∑—Ä–µ–ª–æ—Å—Ç–∏
 * @param relationshipMaturity - —É—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
 * @param indicators - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
 * @param dominantZone - –¥–æ–º–∏–Ω–∞–Ω—Ç–Ω–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–æ–Ω–∞
 */
const MaturityGapAnalysisRefactored: React.FC<MaturityGapProps> = ({
  personalMaturity,
  relationshipMaturity,
  indicators = [], // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  dominantZone
}) => {
  const gap = analyzeMaturityGap(personalMaturity, relationshipMaturity, dominantZone, indicators);
  
  // –ü–æ–ª—É—á–∞–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑—Ä—ã–≤–∞
  const getGapIcon = () => {
    const severeClass = getSeverityColorClass('critical');
    const moderateClass = getSeverityColorClass('moderate');
    
    if (gap.direction === 'personal_higher') {
      return gap.gapSize === 'extreme' 
        ? <ArrowUpDown className={severeClass} size={20} />
        : <ArrowUpDown className={moderateClass} size={20} />;
    } else if (gap.direction === 'relationship_higher') {
      return gap.gapSize === 'extreme' 
        ? <ArrowUpDown className={`${severeClass} rotate-180`} size={20} />
        : <ArrowUpDown className={`${moderateClass} rotate-180`} size={20} />;
    } else {
      return <TrendingUp className="text-blue-600" size={20} />;
    }
  };

  return (
    <div className="mb-8">
      <div className="flex items-baseline justify-between mb-4">
        <h3 className="text-lg font-semibold text-gray-900 flex items-center gap-2">
          <Scale className="text-indigo-600" size={20} />
          –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑—Ä—ã–≤–∞ –∑—Ä–µ–ª–æ—Å—Ç–∏
        </h3>
        <Tooltip
          content="–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∞—à–µ–π –ª–∏—á–Ω–æ–π –∑—Ä–µ–ª–æ—Å—Ç—å—é –∏ –∑—Ä–µ–ª–æ—Å—Ç—å—é –æ—Ç–Ω–æ—à–µ–Ω–∏–π, –≤—ã—è–≤–ª—è—è –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥–∏—Å–±–∞–ª–∞–Ω—Å—ã –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏."
          title="–†–∞–∑—Ä—ã–≤ –∑—Ä–µ–ª–æ—Å—Ç–∏"
          trigger="click"
          position="left"
          maxWidth="max-w-sm"
        />
      </div>
      
      <AnalysisCard
        title={gap.title}
        description={gap.description}
        severity={gap.severity}
        icon={getGapIcon()}
        characteristics={gap.characteristics}
        additionalSections={[
          {
            title: "–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏",
            items: gap.balancingStrategies,
            icon: <TrendingUp className="text-indigo-600" size={16} />
          }
        ]}
        className="border-l-4 rounded-lg"
      />
      
      <div className="mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
        <p className="text-sm text-gray-600 dark:text-gray-300">
          <span className="font-medium text-gray-700 dark:text-gray-200">–û–∂–∏–¥–∞–µ–º—ã–µ —Å—Ä–æ–∫–∏ –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏:</span> {gap.expectedTimeframe}
        </p>
      </div>
    </div>
  );
};

export default MaturityGapAnalysisRefactored;
