#!/usr/bin/env python3\n\"\"\"\nВАЛИДАЦИЯ СИСТЕМЫ \"Лестница Союза\"\nПроверяет логику и структуру всех модулей\n\"\"\"\n\nimport os\nimport re\nimport json\n\ndef check_file_exists(path):\n    \"\"\"Проверить существование файла\"\"\"\n    return os.path.isfile(path)\n\ndef count_lines(filepath):\n    \"\"\"Подсчитать строки кода в файле\"\"\"\n    try:\n        with open(filepath, 'r', encoding='utf-8') as f:\n            return len(f.readlines())\n    except:\n        return 0\n\ndef extract_exports(filepath):\n    \"\"\"Извлечь экспорты из TypeScript файла\"\"\"\n    exports = []\n    try:\n        with open(filepath, 'r', encoding='utf-8') as f:\n            content = f.read()\n            # Find export statements\n            export_matches = re.findall(r'export\\s+(?:function|class|interface|const|type)\\s+(\\w+)', content)\n            exports.extend(export_matches)\n            # Find export * from\n            export_from = re.findall(r'export\\s+\\*\\s+from\\s+['\\\"]([^'\\\"]+)['\\\"]', content)\n            for exp in export_from:\n                exports.append(f\"...from {exp}\")\n    except:\n        pass\n    return exports\n\ndef validate_json(filepath):\n    \"\"\"Проверить валидность JSON файла\"\"\"\n    try:\n        with open(filepath, 'r', encoding='utf-8') as f:\n            json.load(f)\n        return True\n    except:\n        return False\n\ndef main():\n    print(\"\\n\" + \"=\"*70)\n    print(\"  ВАЛИДАЦИЯ СИСТЕМЫ 'Лестница Союза'\")\n    print(\"=\"*70 + \"\\n\")\n    \n    base_path = \"/Users/sergeikhokhlov/windsurf/12union-v2\"\n    src_path = os.path.join(base_path, \"src\")\n    \n    # Список файлов которые должны быть\n    required_files = {\n        'types.ts': 'Типы данных',\n        'levels-definitions.ts': 'Определения 12 уровней',\n        'questions-database.ts': '34 психологических вопроса',\n        'adaptive-algorithm.ts': 'Адаптивный алгоритм',\n        'validation-engine.ts': '4-слойная валидация',\n        'score-calculation.ts': 'Расчет оценок',\n        'action-library.ts': '36 действий (3 х 12)',\n        'results-interpreter.ts': 'Интерпретация результатов',\n        'test-orchestrator.ts': 'Главный оркестратор',\n        'index.ts': 'Публичный API',\n    }\n    \n    print(\"✓ ПРОВЕРКА ФАЙЛОВ\\n\")\n    \n    all_files_exist = True\n    total_lines = 0\n    \n    for filename, description in required_files.items():\n        filepath = os.path.join(src_path, filename)\n        exists = check_file_exists(filepath)\n        lines = count_lines(filepath) if exists else 0\n        total_lines += lines\n        \n        status = \"✓\" if exists else \"✗\"\n        print(f\"  {status} {filename:30} ({lines:5} строк) - {description}\")\n        \n        if not exists:\n            all_files_exist = False\n    \n    print(f\"\\n  Всего кода в модулях: {total_lines} строк\")\n    \n    # Проверить test файлы\n    print(\"\\n✓ ПРОВЕРКА ТЕСТОВ\\n\")\n    test_file = os.path.join(src_path, '__tests__', 'system.test.ts')\n    exists = check_file_exists(test_file)\n    lines = count_lines(test_file) if exists else 0\n    status = \"✓\" if exists else \"✗\"\n    print(f\"  {status} system.test.ts ({lines} строк) - 5 комплексных сценариев тестирования\")\n    \n    # Проверить конфигурационные файлы\n    print(\"\\n✓ ПРОВЕРКА КОНФИГУРАЦИИ\\n\")\n    \n    config_files = {\n        'package.json': 'NPM конфигурация',\n        'tsconfig.json': 'TypeScript конфигурация',\n        'vercel.json': 'Vercel конфигурация',\n        '.gitignore': 'Git конфигурация',\n        '.nvmrc': 'Node version',\n        'README.md': 'Документация',\n    }\n    \n    for filename, description in config_files.items():\n        filepath = os.path.join(base_path, filename)\n        exists = check_file_exists(filepath)\n        status = \"✓\" if exists else \"✗\"\n        print(f\"  {status} {filename:20} - {description}\")\n    \n    # Проверить Git\n    print(\"\\n✓ ПРОВЕРКА GIT\\n\")\n    git_path = os.path.join(base_path, '.git')\n    git_exists = os.path.isdir(git_path)\n    status = \"✓\" if git_exists else \"✗\"\n    print(f\"  {status} Git репозиторий инициализирован\")\n    \n    # Проверить содержимое файлов\n    print(\"\\n✓ ПРОВЕРКА СОДЕРЖИМОГО\\n\")\n    \n    # Проверить вопросы\n    questions_file = os.path.join(src_path, 'questions-database.ts')\n    with open(questions_file, 'r', encoding='utf-8') as f:\n        content = f.read()\n        question_count = len(re.findall(r\"\\{\\s*id:\\s*'[^']+'\", content))\n        print(f\"  ✓ Вопросы: {question_count} штук (ожидается 34)\")\n        has_zoning = 'zone-' in content and 'getZoningQuestions' in content\n        has_refinement = 'level-detail-' in content\n        has_validation = 'validation-' in content and 'isValidation' in content\n        print(f\"  ✓ Фаза зонирования: {'да' if has_zoning else 'нет'}\")\n        print(f\"  ✓ Фаза уточнения: {'да' if has_refinement else 'нет'}\")\n        print(f\"  ✓ Фаза валидации: {'да' if has_validation else 'нет'}\")\n    \n    # Проверить уровни\n    levels_file = os.path.join(src_path, 'levels-definitions.ts')\n    with open(levels_file, 'r', encoding='utf-8') as f:\n        content = f.read()\n        level_count = len(re.findall(r\"level:\\s*\\d+\", content))\n        print(f\"  ✓ Уровни: {level_count} штук (ожидается 12)\")\n        has_helpers = 'getLevelDefinition' in content\n        print(f\"  ✓ Хелпер-функции: {'да' if has_helpers else 'нет'}\")\n    \n    # Проверить валидацию\n    validation_file = os.path.join(src_path, 'validation-engine.ts')\n    with open(validation_file, 'r', encoding='utf-8') as f:\n        content = f.read()\n        has_speed = 'analyzeResponseSpeed' in content\n        has_contradictions = 'detectContradictions' in content\n        has_coherence = 'calculateCoherence' in content\n        has_bypass = 'detectSpiritualBypass' in content\n        print(f\"  ✓ Слой 1 (скорость): {'да' if has_speed else 'нет'}\")\n        print(f\"  ✓ Слой 2 (противоречия): {'да' if has_contradictions else 'нет'}\")\n        print(f\"  ✓ Слой 3 (когерентность): {'да' if has_coherence else 'нет'}\")\n        print(f\"  ✓ Слой 4 (духовный байпас): {'да' if has_bypass else 'нет'}\")\n    \n    # Проверить действия\n    actions_file = os.path.join(src_path, 'action-library.ts')\n    with open(actions_file, 'r', encoding='utf-8') as f:\n        content = f.read()\n        level_actions = len(re.findall(r\"LEVEL_\\d+_ACTIONS\", content))\n        print(f\"  ✓ Наборы действий: {level_actions} (ожидается 12)\")\n        action_count = len(re.findall(r\"id:\\s*'l\\d+-action-\", content))\n        print(f\"  ✓ Отдельные действия: {action_count} (ожидается 36)\")\n    \n    # Финальный результат\n    print(\"\\n\" + \"=\"*70)\n    print(\"  РЕЗУЛЬТАТЫ ВАЛИДАЦИИ\")\n    print(\"=\"*70 + \"\\n\")\n    \n    if all_files_exist and git_exists:\n        print(\"✅ ВСЕ ПРОВЕРКИ ПРОЙДЕНЫ\")\n        print(\"\\nСистема полностью готова к тестированию и развертыванию!\\n\")\n        print(\"Следующие шаги:\")\n        print(\"  1. npm install\")\n        print(\"  2. npm run build\")\n        print(\"  3. npm test\")\n        print(\"  4. git push к вашему репозиторию\")\n        print(\"  5. Развернуть на Vercel\\n\")\n        return 0\n    else:\n        print(\"⚠️  НЕКОТОРЫЕ ПРОВЕРКИ НЕ ПРОЙДЕНЫ\\n\")\n        return 1\n\nif __name__ == '__main__':\n    exit(main())\n